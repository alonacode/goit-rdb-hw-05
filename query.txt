# Task1
SELECT 
    od.*,
    (SELECT o.customer_id 
     FROM orders o 
     WHERE o.id = od.order_id) AS customer_id
FROM order_details od;

# Task2
SELECT *
FROM order_details od
WHERE od.order_id IN (
    SELECT o.id
    FROM orders o
    WHERE o.shipper_id = 3
);

# Task3
SELECT 
    sub.order_id,
    AVG(sub.quantity) AS avg_quantity
FROM (
    SELECT *
    FROM order_details
    WHERE quantity > 10
) AS sub
GROUP BY sub.order_id;

# Task4

SELECT @@version; 8.3.0

WITH tmp AS (
SELECT * 
FROM order_details 
WHERE quantity > 10
)
SELECT tmp.order_id,
    AVG(tmp.quantity) AS avg_quantity
FROM tmp
GROUP BY tmp.order_id;


# Task5

# У DBeaver не працює DELIMETER

USE `goit-rdb-hw-03`;

DROP FUNCTION IF EXISTS divide_values;


CREATE FUNCTION divide_values(
    val1 FLOAT,
    val2 FLOAT
)
RETURNS FLOAT
DETERMINISTIC
NO SQL
BEGIN
    DECLARE result FLOAT;
    SET result = val1 / val2;
    RETURN result;
END;


SELECT 
    od. *,
    divide_values(od.quantity, 2.0) AS divided_quantity
FROM order_details od;